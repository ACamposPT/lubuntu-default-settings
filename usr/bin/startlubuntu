#!/bin/sh

if [ -z "$XDG_CONFIG_HOME" ]; then
    export XDG_CONFIG_HOME="$HOME/.config"
fi

# Ensure the existance of pcmanfm config file
PCMANFM_CONF_DIR="$XDG_CONFIG_HOME/pcmanfm"
if [ ! -f "$PCMANFM_CONF_DIR/main.lubuntu" ]; then
    mkdir -p "$PCMANFM_CONF_DIR"
    cp /usr/share/lubuntu/pcmanfm/main.lubuntu "$PCMANFM_CONF_DIR/main.lubuntu"
fi

# Ensure the existance of openbox config file
OPENBOX_CONF_DIR="$XDG_CONFIG_HOME/openbox"
if [ ! -f "$OPENBOX_CONF_DIR/lubuntu-rc.xml" ]; then
    mkdir -p "$OPENBOX_CONF_DIR"
    cp /usr/share/lubuntu/openbox/rc.xml "$OPENBOX_CONF_DIR/lubuntu-rc.xml"
fi

# Workaround for gdm, openbox and the number of desktops
NUMBER_DESKTOPS=`grep \<number\> "$OPENBOX_CONF_DIR/llubuntu-rc.xml" | awk -F \> {'print $2}' | awk -F \< {'print $1}'`
if test x"`which wmctrl 2>/dev/null`" != x""; then
    (until [ `wmctrl -d | wc -l ` = "$NUMBER_DESKTOPS" ];do
	wmctrl -n "$NUMBER_DESKTOPS"
    done) &
fi

# Enable GTK+2 integration for OpenOffice.org, if available.
export SAL_USE_VCLPLUGIN=gtk

# Start the LXDE session
exec /usr/bin/lxsession -s Lubuntu
